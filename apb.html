<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Score Analysis</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    td.highlight {
      background-color: #ffff99;
    }
  </style>
</head>
<body>
  <h1>Salesforcel認定 PLATFORM アプリケーションビルダー<br/>
  正答率解析 合格点63%</h1>
  <textarea id="score-input" rows="10" cols="50" placeholder="ここに結果を貼り付けてください。&#10;例：&#10;Salesforce Fundamentals（SALESFORCE の基本） &#58;	70%&#10;...&#10;...&#10;...&#10;App Deployment（アプリケーションのリリース）	&#20;70%"></textarea><br>
  <button id="analyze-button">解析</button>
  <button id="clear-button">クリア</button>
  <table>
    <thead>
      <tr>
        <th>カテゴリ名</th>
        <th>出題割合</th>
        <th>出題数</th>
        <th>正解率</th>
        <th>正解数</th>
        <th>不正解数</th>
        <th>合格ラインとの差</th>
      </tr>
    </thead>
    <tbody id="results-body">
      <!-- 結果表示エリア -->
    </tbody>
  </table>

  <script>
    const settings = {
      "Salesforce Fundamentals": 23,
      "Data Modeling and Management": 22,
      "Business Logic and Process Automation": 28,
      "User Interface": 17,
      "App Deployment": 10
      // "SALESFORCE の基本": 23,
      // "データモデリングおよび管理": 22,
      // "ビジネスロジックとプロセスの自動化": 28,
      // "ユーザインターフェース": 17,
      // "アプリケーションのリリース": 10
    };
    //Parse User Input
    function parseUserInput(input) {
      const scores = {};
      let match;
      let pattern = /^(.+?)(?:\（.+?\）)?[\s:]*\s+(\d+)%/gm; // コロンの有無に関わらず対応するパターン

      while ((match = pattern.exec(input)) !== null) {
        let category = match[1].trim();
        category = category.replace(/（.+?）/g, '').trim(); // 日本語名を削除
        const score = parseInt(match[2], 10);

        Object.keys(settings).forEach((setting) => {
          // 設定名が入力されたカテゴリ名に部分的に含まれているか確認
          if (setting.toLowerCase() === category.toLowerCase()) {
            scores[setting] = score;
          }
        });
      }

  return scores;
}

    // caluclateScores
    function calculateScores(userScores) {
      const totalQuestions = 60; // 総問題数
      const passingScore = 63; // 合格ライン（パーセンテージ）
      const results = {};
      let totalCorrectAnswers = 0;

      Object.keys(settings).forEach((category) => {
        const weight = settings[category];
        const scorePercentage = userScores[category] || 0;
        const questions = (totalQuestions * weight) / 100;
        const correctAnswers = (scorePercentage * questions) / 100;
        const incorrectAnswers = questions - correctAnswers;
        totalCorrectAnswers += correctAnswers; // 総正解数を更新

        results[category] = {
          '出題割合': weight,
          '出題数': questions,
          '正解率': scorePercentage,
          '正解数': correctAnswers,
          '不正解数': incorrectAnswers
        };
      });

      // 合格ラインに関連する計算
      const totalPercentage = (totalCorrectAnswers / totalQuestions) * 100;
      const questionsToPass = Math.ceil(totalQuestions * (passingScore / 100));
      const differenceToPass = totalCorrectAnswers - questionsToPass;

      // 総合結果の追加
      results['総合結果'] = {
        '総問題数': totalQuestions,
        '合格ライン': passingScore,
        '必要正解数': questionsToPass,
        '総正解数': totalCorrectAnswers,
        '総合正解率': totalPercentage,
        '合格ラインとの差': differenceToPass
      };

      return results;
    }



    // display Results
    function displayResults(results) {
      const resultsBody = document.getElementById('results-body');
      resultsBody.innerHTML = ''; // 既存の結果をクリア

      // カテゴリ毎の結果をテーブルに表示
      Object.keys(results).forEach((category) => {
        if (category !== '総合結果') {
          const tr = resultsBody.insertRow();
          tr.insertCell().textContent = category;
          tr.insertCell().textContent = results[category]['出題割合'] + '%';
          tr.insertCell().textContent = results[category]['出題数'].toFixed(2);
          tr.insertCell().textContent = results[category]['正解率'] + '%';
          tr.insertCell().textContent = results[category]['正解数'].toFixed(2);
          tr.insertCell().textContent = results[category]['不正解数'].toFixed(2);
        }
      });

      // 総合結果の行をテーブルに表示
      const totalResults = results['総合結果'];
      const trTotal = resultsBody.insertRow();
      trTotal.classList.add('highlight'); // スタイルの適用
      trTotal.insertCell().textContent = '総合結果';
      trTotal.insertCell().textContent = '---'; // 出題割合は表示不要
      trTotal.insertCell().textContent = totalResults['総問題数'] + '問'; // 総問題数
      trTotal.insertCell().textContent = totalResults['総合正解率'].toFixed(2) + '%'; // 総合正解率
      // trTotal.insertCell().textContent = totalResults['必要正解数']; // 必要正解数
      trTotal.insertCell().textContent =  totalResults['総正解数'].toFixed(2) + '問'; // 総正解数
      trTotal.insertCell().textContent = (totalResults['総問題数'] - totalResults['総正解数']).toFixed(2) + '問'; // 総不正解数
      const differenceToPass = totalResults['合格ラインとの差'];
      trTotal.insertCell().textContent = (differenceToPass >= 0 ? '+' + differenceToPass.toFixed(2) : differenceToPass.toFixed(2)) + '問'; // 合格ラインとの差
    }

    // Event Listner for clear-button
    document.getElementById('clear-button').addEventListener('click', () => {
      document.getElementById('score-input').value = '';
    })

    // Event Listner for analyze-button
    document.getElementById('analyze-button').addEventListener('click', () => {
      const input = document.getElementById('score-input').value;
      const userScores = parseUserInput(input);
      if (Object.keys(userScores).length === 0) {
        // パースに失敗した場合のエラーメッセージを表示
        alert("テキストの形式が正しくありません。");
      } else {
        const results = calculateScores(userScores);
        displayResults(results);
      }
    });


  </script>
  <br />
  <a href="index.html">アドミニストレーター正答率解析</a>
</body>
</html>
