<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Score Analysis</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #e7f2fa;
      padding: 20px;
      margin: 0;
    }
    #score-input {
      width: 98%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #009edb;
      font-size: 14px;
      margin-bottom: 10px;
      box-shadow: inset 0 0 5px rgba(0, 158, 219, 0.5);
    }
    #score-input:focus {
      outline: none;
      border-color: #0079b8;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #009edb;
      color: white;
      cursor: pointer;
      font-size: 14px;
      margin-right: 5px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0079b8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #009edb;
    }
    th {
      background-color: #009edb;
      color: white;
    }
    td.highlight {
      background-color: #e1f0f8;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      margin: 20px auto;
    }
    .title {
      text-align: center;
      color: #009edb;
      margin: 0;
      padding: 10px;
      font-size: 24px;
    }
    .description {
      text-align: center;
      color: #0079b8;
      margin-top: 0;
      margin-bottom: 30px;
      font-size: 18px;
    }
    .links {
      padding: 20px;
      margin-top: 20px;
      text-align: center;
    }
    .link-button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #009edb;
      color: white;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none; /* リンクの下線を取り除く */
      margin: 0 10px; /* リンクの間にスペースを追加 */
      transition: 0.3s;
    }
    .link-button:hover {
      background-color: #0079b8;
    }
    @media screen and (max-width: 768px) {
      .container {
        width: 95%;
        margin: 10px auto;
        padding: 5px
      }
      .title {
        font-size: 20px;
      }

      .description {
        font-size: 16px;
      }

      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }

      .link-button {
        display: block;
        width: 90%;
        margin: 10px auto;
      }

      /* ボタンサイズの調整 */
      button {
        padding: 8px 16px;
        font-size: 12px;
      }

      /* テキストエリアのサイズ調整 */
      #score-input {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">Salesforce認定アドミニストレーター</h1>
    <p class="description">正答率解析 合格点65%</p>
    <textarea id="score-input" rows="10" cols="50" placeholder="ここに結果を貼り付けて、解析ボタンを押してください。 以下貼り付ける例：

    Configuration and Setup（設定とセットアップ） &#58;	70%
    Object Manager and Lightning App Builder（オブジェクトマネージャとLightning アプリケーションビルダー）	70%
    Sales and Marketing Applications（セールス&#38;マーケティングアプリケーション）	70%
    Service and Support Applications（サービス&#38;サポートアプリケーション）	70%
    Productivity and Collaboration（生産性向上とコラボレーション）	70%
    Data and Analytics Management（データ管理&#38;分析）	70%
    Workflow/Process Automation（ワークフロー/プロセスの自動化）&#20;70%"></textarea><br>
    <button id="analyze-button">解析</button>
    <button id="clear-button">クリア</button>
    <table>
      <thead>
        <tr>
          <th>カテゴリ名</th>
          <th>出題割合</th>
          <th>出題数</th>
          <th>正解率</th>
          <th>正解数</th>
          <th>不正解数</th>
          <th>合格ラインとの差</th>
        </tr>
      </thead>
      <tbody id="results-body">
        <!-- 結果表示エリア -->
      </tbody>
    </table>
  <div class="links">
    <a href="pab.html" class="link-button">アプリケーション PLATFORM ビルダー</a>
    <a href="adv_admin.html" class="link-button">上級アドミニストレーター</a>
  </div>
</div>
  <script>
    const settings = {
      "Configuration and Setup": 20,
      "Object Manager and Lightning App Builder": 20,
      "Sales and Marketing Applications": 12,
      "Service and Support Applications": 11,
      "Productivity and Collaboration": 7,
      "Data and Analytics Management": 14,
      "Workflow/Process Automation": 16
    };
    //Parse User Input
    function parseUserInput(input) {
      const scores = {};
      let match;
      let pattern = /^(.+?)(?:\（.+?\）)?[\s:]*\s+(\d+)%/gm; // コロンの有無に関わらず対応するパターン

      while ((match = pattern.exec(input)) !== null) {
        let category = match[1].trim();
        category = category.replace(/（.+?）/g, '').trim(); // 日本語名を削除
        const score = parseInt(match[2], 10);

        Object.keys(settings).forEach((setting) => {
          // 設定名が入力されたカテゴリ名に部分的に含まれているか確認
          if (setting.toLowerCase() === category.toLowerCase()) {
            scores[setting] = score;
          }
        });
      }

  return scores;
}

    // caluclateScores
    function calculateScores(userScores) {
      const totalQuestions = 60; // 総問題数
      const passingScore = 65; // 合格ライン（パーセンテージ）
      const results = {};
      let totalCorrectAnswers = 0;

      Object.keys(settings).forEach((category) => {
        const weight = settings[category];
        const scorePercentage = userScores[category] || 0;
        const questions = (totalQuestions * weight) / 100;
        const correctAnswers = (scorePercentage * questions) / 100;
        const incorrectAnswers = questions - correctAnswers;
        totalCorrectAnswers += correctAnswers; // 総正解数を更新

        results[category] = {
          '出題割合': weight,
          '出題数': questions,
          '正解率': scorePercentage,
          '正解数': correctAnswers,
          '不正解数': incorrectAnswers
        };
      });

      // 合格ラインに関連する計算
      const totalPercentage = (totalCorrectAnswers / totalQuestions) * 100;
      const questionsToPass = totalQuestions * (passingScore / 100);
      const differenceToPass = totalCorrectAnswers - questionsToPass;

      // 総合結果の追加
      results['総合結果'] = {
        '総問題数': totalQuestions,
        '合格ライン': passingScore,
        '必要正解数': questionsToPass,
        '総正解数': totalCorrectAnswers,
        '総合正解率': totalPercentage,
        '合格ラインとの差': differenceToPass
      };

      return results;
    }



    // display Results
    function displayResults(results) {
      const resultsBody = document.getElementById('results-body');
      resultsBody.innerHTML = ''; // 既存の結果をクリア

      // カテゴリ毎の結果をテーブルに表示
      Object.keys(results).forEach((category) => {
        if (category !== '総合結果') {
          const tr = resultsBody.insertRow();
          tr.insertCell().textContent = category;
          tr.insertCell().textContent = results[category]['出題割合'] + '%';
          tr.insertCell().textContent = results[category]['出題数'].toFixed(3);
          tr.insertCell().textContent = results[category]['正解率'] + '%';
          tr.insertCell().textContent = results[category]['正解数'].toFixed(3);
          tr.insertCell().textContent = results[category]['不正解数'].toFixed(3);
        }
      });

      // 総合結果の行をテーブルに表示
      const totalResults = results['総合結果'];
      const trTotal = resultsBody.insertRow();
      trTotal.classList.add('highlight'); // スタイルの適用
      trTotal.insertCell().textContent = '総合結果';
      trTotal.insertCell().textContent = '100%'; // 出題割合は表示不要
      trTotal.insertCell().textContent = totalResults['総問題数'] + '問'; // 総問題数
      trTotal.insertCell().textContent = totalResults['総合正解率'].toFixed(3) + '%'; // 総合正解率
      // trTotal.insertCell().textContent = totalResults['必要正解数']; // 必要正解数
      trTotal.insertCell().textContent =  totalResults['総正解数'].toFixed(3) + '問'; // 総正解数
      trTotal.insertCell().textContent = (totalResults['総問題数'] - totalResults['総正解数']).toFixed(3) + '問'; // 総不正解数
      const differenceToPass = totalResults['合格ラインとの差'];
      trTotal.insertCell().textContent = (differenceToPass >= 0 ? '+' + differenceToPass.toFixed(3) : differenceToPass.toFixed(3)) + '問'; // 合格ラインとの差
    }

    // Event Listner for clear-button
    document.getElementById('clear-button').addEventListener('click', () => {
      document.getElementById('score-input').value = '';
    })

    // Event Listner for analyze-button
    document.getElementById('analyze-button').addEventListener('click', () => {
      const input = document.getElementById('score-input').value;
      const userScores = parseUserInput(input);
      if (Object.keys(userScores).length === 0) {
        // パースに失敗した場合のエラーメッセージを表示
        alert("テキストの形式が正しくありません。");
      } else {
        const results = calculateScores(userScores);
        displayResults(results);
      }
    });

    // 共通設定を保存するオブジェクト
    const commonSettings = {
      title: "Salesforce認定アドミニストレーター",
      description: "正答率解析 合格点 65点",
      placeholder: "ここに結果を貼り付けて、解析ボタンを押してください。 以下貼り付ける例：\n\n    Configuration and Setup（設定とセットアップ） &#58;	70%",
      settings: {
        "Configuration and Setup": 20,
        "Object Manager and Lightning App Builder": 20,
        "Sales and Marketing Applications": 12,
        "Service and Support Applications": 11,
        "Productivity and Collaboration": 7,
        "Data and Analytics Management": 14,
        "Workflow/Process Automation": 16
      },
      totalQuestions: 60,
      passingScore: 65
    }

  </script>
</body>
</html>
